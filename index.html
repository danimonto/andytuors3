<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Andy Tuors & Cia.</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f0f0;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: start;
    }

    h1 {
      margin-top: 40px;
      font-size: 40px;
      color: #333;
      text-align: center;
    }

    .timer-settings {
      margin: 30px 0 10px;
    }

    .timer-settings input, .timer-settings select {
      padding: 6px;
      width: 60px;
      margin: 0 5px;
    }

    button {
      padding: 8px 16px;
      margin-left: 10px;
      cursor: pointer;
    }

    #countdown {
      font-size: 24px;
      margin-bottom: 20px;
      color: #333;
    }

    .multi-track {
      position: relative;
      width: 90%;
      max-width: 900px;
      background: transparent;
      margin-bottom: 40px;
    }

    .row {
      width: 100%;
      height: 60px;
      background: #ddd;
      border-radius: 30px;
      margin-bottom: 10px;
      position: relative;
      box-sizing: border-box;
    }

    .connector {
      position: absolute;
      width: 20px;
      height: 20px;
      background: #4caf50;
      border-radius: 50%;
      left: calc(100% - 20px);
      bottom: -15px;
      z-index: 1;
    }

    .runner {
      position: absolute;
      font-size: 30px;
      z-index: 10;
      transition: top 1s linear, left 1s linear, transform 0.2s;
    }

    .marker {
      position: absolute;
      top: -20px;
      font-size: 12px;
      color: #444;
    }
  </style>
</head>
<body>
  <h1>Andy Tuors & Cia.</h1>

  <div class="timer-settings">
    <label>Horas:</label>
    <input type="number" id="hours" min="1" value="2">
    <label>Minutos:</label>
    <input type="number" id="minutes" min="0" max="59" value="0">
    <label>Corredores:</label>
    <select id="runnersCount">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
    </select>
    <button onclick="startRun()">Iniciar</button>
  </div>

  <div id="countdown">00:02:00</div>

  <div class="multi-track" id="multiTrack"></div>

  <script>
    let countdownInterval;
    let totalDuration;

    function startRun() {
      const countdownDisplay = document.getElementById('countdown');
      const trackContainer = document.getElementById('multiTrack');
      const hours = parseInt(document.getElementById('hours').value) || 0;
      const minutes = parseInt(document.getElementById('minutes').value) || 0;
      const runnerCount = parseInt(document.getElementById('runnersCount').value);

      let totalSeconds = (hours * 60 + minutes) * 60;
      if (totalSeconds === 0) return;
      totalDuration = totalSeconds;

      clearInterval(countdownInterval);
      trackContainer.innerHTML = '';

      const rowHeight = 70;
      const trackWidth = trackContainer.offsetWidth - 60;

      // Crear filas con conectores y marcadores de hora
      for (let i = 0; i < hours; i++) {
        const row = document.createElement('div');
        row.className = 'row';

        const marker = document.createElement('div');
        marker.className = 'marker';
        marker.style.left = (i % 2 === 0 ? '10px' : (trackWidth - 20) + 'px');
        marker.style.top = '-20px';
        marker.innerText = `Hora ${i + 1}`;
        row.appendChild(marker);

        if (i > 0) {
          const connector = document.createElement('div');
          connector.className = 'connector';
          connector.style.left = i % 2 === 0 ? 'calc(100% - 20px)' : '0px';
          connector.style.transform = 'translateY(-50%)';
          row.appendChild(connector);
        }

        trackContainer.appendChild(row);
      }

      // Iconos de inicio y fin
      const firstRow = trackContainer.children[0];
      const lastRow = trackContainer.children[trackContainer.children.length - 1];
      const startIcon = document.createElement('div');
      startIcon.innerText = '🪑';
      startIcon.style.position = 'absolute';
      startIcon.style.left = '10px';
      startIcon.style.top = '10px';
      trackContainer.appendChild(startIcon);

      const endIcon = document.createElement('div');
      endIcon.innerText = '🚗';
      endIcon.style.position = 'absolute';
      endIcon.style.right = '10px';
      endIcon.style.top = ((hours - 1) * rowHeight + 10) + 'px';
      trackContainer.appendChild(endIcon);

      // Crear corredores
      for (let i = 0; i < runnerCount; i++) {
        const runner = document.createElement('div');
        runner.className = 'runner';
        runner.id = 'runner' + i;
        runner.innerText = '🏃';
        runner.style.left = (10 + i * 20) + 'px';
        runner.style.top = '10px';
        runner.style.transform = 'scaleX(1)';
        trackContainer.appendChild(runner);
      }

      let currentLine = 0;
      let direction = 1;
      let segmentTime = totalSeconds / (hours * 2 - 1); // incluye transiciones

      countdownDisplay.textContent = formatTime(totalSeconds);
      countdownInterval = setInterval(() => {
        totalSeconds--;
        countdownDisplay.textContent = formatTime(totalSeconds);
        if (totalSeconds === 5 * 60) alert("Vaya saludando");
        if (totalSeconds <= 0) {
          clearInterval(countdownInterval);
          alert("Rajemos");
        }
      }, 1000);

      // Movimiento
      function moveNext() {
        if (currentLine >= hours) return;
        const left = direction === 1 ? (trackWidth) : 0;
        const top = currentLine * rowHeight + 10;

        for (let i = 0; i < runnerCount; i++) {
          const runner = document.getElementById('runner' + i);
          runner.style.transition = `left ${segmentTime}s linear, top ${segmentTime}s linear`;
          runner.style.left = (left + i * 20) + 'px';
          runner.style.top = top + 'px';
          runner.style.transform = direction === 1 ? 'scaleX(1)' : 'scaleX(-1)';
        }

        direction *= -1;
        currentLine++;

        if (currentLine < hours) {
          setTimeout(moveNext, segmentTime * 1000);
        }
      }

      setTimeout(moveNext, 500);
    }

    function formatTime(totalSeconds) {
      let hrs = Math.floor(totalSeconds / 3600);
      let mins = Math.floor((totalSeconds % 3600) / 60);
      let secs = totalSeconds % 60;
      return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }
  </script>
</body>
</html>
