<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Andy Tuors & Cia.</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f0f0;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: start;
    }

    h1 {
      margin-top: 40px;
      font-size: 40px;
      color: #333;
      text-align: center;
    }

    .timer-settings {
      margin: 30px 0 10px;
    }

    .timer-settings input {
      padding: 6px;
      width: 60px;
      margin: 0 5px;
    }

    button {
      padding: 8px 16px;
      margin-left: 10px;
      cursor: pointer;
    }

    #countdown {
      font-size: 24px;
      margin-bottom: 20px;
      color: #333;
    }

    .map-container {
      position: relative;
      width: 1080px;
      height: 720px;
      margin-bottom: 40px;
    }

    svg {
      width: 100%;
      height: 100%;
    }

    .runner {
      position: absolute;
      font-size: 30px;
      transform: translate(-50%, -50%) scaleX(-1);
      transition: transform 0.1s linear;
    }

    .icon {
      position: absolute;
      font-size: 32px;
      transform: translate(-50%, -50%);
    }

    .hour-marker {
      position: absolute;
      font-size: 12px;
      background: #fff;
      padding: 2px 4px;
      border: 1px solid #ccc;
      border-radius: 4px;
      transform: translate(-50%, -50%);
    }
  </style>
</head>
<body>
  <h1>Andy Tuors & Cia.</h1>

  <div class="timer-settings">
    <label>Inicio:</label>
    <input type="number" id="startHour" min="0" max="23" value="8">:
    <input type="number" id="startMinute" min="0" max="59" value="0">
    <label>Fin:</label>
    <input type="number" id="endHour" min="0" max="23" value="10">:
    <input type="number" id="endMinute" min="0" max="59" value="0">
    <button onclick="startRun()">Iniciar</button>
  </div>

  <div id="countdown">00:00:00</div>

  <div class="map-container">
    <svg id="routeSVG" viewBox="0 0 1080 720" xmlns="http://www.w3.org/2000/svg">
      <path id="routePath" d="M381 86C381 86 386 85 394 84C402 83 414 80 422 80C435 80 455 88 465 95C480 105 506 116 524 116C546 116 563 105 582 104C600 103 618 108 636 108C653 108 670 105 688 105C703 105 717 108 731 108C745 108 755 105 765 103C775 101 792 93 805 91C817 89 826 94 839 94C849 94 863 91 875 91C887 91 902 96 918 96C934 96 946 96 960 96C974 96 986 91 997 89C1007 87 1019 89 1027 92C1035 95 1044 100 1050 103C1056 106 1061 108 1067 108" fill="none" stroke="#ddd" stroke-width="8"/>
      <path id="progressPath" d="" fill="none" stroke="#4caf50" stroke-width="8"/>
    </svg>
    <div id="runner" class="runner">üèÉ</div>
    <div id="startIcon" class="icon">ü™ë</div>
    <div id="endIcon" class="icon">üöó</div>
  </div>

  <script>
    function formatTime(totalSeconds) {
      let hrs = Math.floor(totalSeconds / 3600);
      let mins = Math.floor((totalSeconds % 3600) / 60);
      let secs = totalSeconds % 60;
      return `${hrs.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    function startRun() {
      const startHour = parseInt(document.getElementById('startHour').value);
      const startMinute = parseInt(document.getElementById('startMinute').value);
      const endHour = parseInt(document.getElementById('endHour').value);
      const endMinute = parseInt(document.getElementById('endMinute').value);

      const start = new Date();
      start.setHours(startHour, startMinute, 0);
      const end = new Date();
      end.setHours(endHour, endMinute, 0);

      let totalSeconds = Math.floor((end - start) / 1000);
      if (totalSeconds <= 0) return alert("Hora de fin debe ser posterior a la de inicio");

      const route = document.getElementById('routePath');
      const progress = document.getElementById('progressPath');
      const runner = document.getElementById('runner');
      const startIcon = document.getElementById('startIcon');
      const endIcon = document.getElementById('endIcon');

      const pathLength = route.getTotalLength();
      route.style.strokeDasharray = pathLength;
      route.style.strokeDashoffset = 0;
      progress.setAttribute('d', route.getAttribute('d'));
      progress.style.strokeDasharray = pathLength;
      progress.style.strokeDashoffset = pathLength;

      const countdown = document.getElementById('countdown');
      const startTime = Date.now();
      const endTime = startTime + totalSeconds * 1000;

      startIcon.style.left = `${route.getPointAtLength(0).x}px`;
      startIcon.style.top = `${route.getPointAtLength(0).y}px`;
      endIcon.style.left = `${route.getPointAtLength(pathLength).x}px`;
      endIcon.style.top = `${route.getPointAtLength(pathLength).y}px`;

      function animate() {
        const now = Date.now();
        const elapsed = now - startTime;
        const progressRatio = Math.min(elapsed / (totalSeconds * 1000), 1);
        const currentLength = pathLength * progressRatio;

        const pos = route.getPointAtLength(currentLength);
        const prevPos = route.getPointAtLength(Math.max(currentLength - 1, 0));
        const angle = Math.atan2(pos.y - prevPos.y, pos.x - prevPos.x) * 180 / Math.PI;

        runner.style.left = `${pos.x}px`;
        runner.style.top = `${pos.y}px`;
        runner.style.transform = `translate(-50%, -50%) rotate(${angle}deg) scaleX(-1)`;

        progress.style.strokeDashoffset = pathLength - currentLength;

        if (progressRatio < 1) {
          requestAnimationFrame(animate);
        } else {
          alert("Rajemos");
        }
      }

      animate();

      const timer = setInterval(() => {
        let remaining = Math.max(0, Math.floor((endTime - Date.now()) / 1000));
        countdown.textContent = formatTime(remaining);
        if (remaining === 300) alert("Vaya saludando");
        if (remaining <= 0) clearInterval(timer);
      }, 1000);
    }
  </script>
</body>
</html>